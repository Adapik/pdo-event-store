<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
    <meta name="HandheldFriendly" content="True"/>
    <title>Interop Factories</title>
    <link rel="stylesheet"
          href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/cerulean/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://tobiju.github.io/share/prismjs/prism-ghcolors.css"/>
    <link rel="stylesheet"
          href="https://tobiju.github.io/share/prismjs/prism-linenumbers.css"/>
    <style>
        body, html {
            height: 100%;
            padding-top: 36px;
            position: relative;
        }

        img {
            max-width: 100%;
        }

        .page-wrapper {
            min-height: 100%;
            padding-bottom: 170px;
            position: relative;
        }

        /* Header Section */
        header {
            background: white;
            color: black;
            font-size: 16px;
            font-weight: 300;
        }

        h1:first-child {
            margin-top: 0;
        }

        /* anchor link will be displayed after the static top nav */
        h1:before,
        h2:before,
        h3:before,
        h4:before,
        h5:before,
        h6:before {
            display: block;
            content: " ";
            margin-top: -64px;
            height: 64px;
            visibility: hidden;
        }

        .navbar-brand {
            padding: 0;
        }

        .navbar-brand img {
            max-height: 100%;
        }

        /* Content Section */
        #content {
            margin-bottom: 17px;
            font-size: 17px;
            min-height: 200px;
        }

        .breadcrumb {
            position: relative;
            z-index: 999;
        }

        .links {
            background: #f8f8f8;
            border-top: 1px solid #e5e5e5;
            border-bottom: 1px solid #e5e5e5;
            padding: 16px 0;
        }

        .links .prev {
            text-align: left;
        }

        .links .parent {
            text-align: center;
        }

        .links .next {
            text-align: right;
        }

        /* TOC */
        .list-toc .list-group-item {
            background: 0 none;
            position: relative;
            font-weight: bold;
            padding: 0;
        }

        .list-toc .list-group-item.level-2 {
            padding-left: 20px;
        }

        .list-toc .list-group-item.level-3 {
            padding-left: 40px;
        }

        .list-toc .list-group-item.level-4 {
            padding-left: 20px;
        }

        .list-toc .list-group-item .row {
            padding: 7px 0;
        }

        .list-toc .list-group-item .text-number {
            padding-left: 10px;
        }

        .list-toc .list-toc-nested .list-group-item {
            font-weight: normal;
            border: 0 none !important;
        }

        .list-toc .list-toc-nested {
            margin-bottom: 0;
            padding-bottom: 10px;
        }

        .list-toc .list-group-item .bbt-toc-toggle {
            display: block;
            position: absolute;
            top: 5px;
            right: 10px;
            font-weight: normal;
        }
        .list-toc .list-group-item .bbt-toc-toggle:before {
            content: "";
            display: block;
        }
        .list-toc .list-group-item .bbt-toc-toggle.collapsed:before {
            content: "";
            display: block;
        }

        .list-toc > li:nth-child(2n+1) {
            background: rgba(0, 0, 0, 0.03);
        }

        .bbt-theme-cyborg .list-toc > li:nth-child(2n+1),
        .bbt-theme-darkly .list-toc > li:nth-child(2n+1),
        .bbt-theme-slate .list-toc > li:nth-child(2n+1),
        .bbt-theme-superhero .list-toc > li:nth-child(2n+1) {
            background: rgba(255, 255, 255, 0.05);
        }

        .list-toc .list-group-item {
            border-bottom: 0 none;
            border-left: 0 none;
            border-right: 0 none;
            font-size: inherit;
        }

        .list-toc .list-group-item:first-child {
            border-top-right-radius: 0;
            border-top-left-radius: 0;
        }

        .list-toc .list-group-item:last-child {
            border-bottom-right-radius: 0;
            border-bottom-left-radius: 0;
        }

        /* Left navigation */
        .nav-left ul li a {
            padding-top: 3px;
            padding-bottom: 3px;
            border-left: 1px solid transparent;
        }
        .nav-left ul li.active a,
        .nav-left ul li a:hover {
            background: none !important;
            color: inherit;
            border-color: inherit;
        }

        .affix {
            top: 60px;
        }

        .badge {
            border-radius: 4px;
            padding: 5px;
        }

        /* Footer Section */
        footer {
            color: black;
            background: white;
            width: 100%;
            position: absolute;
            bottom: 0;
        }

        footer #copyright {
            padding: 30px;
            text-align: center;
            color: #444;
        }

        footer #copyright p {
            margin: 0;
        }

        footer #copyright span a {
            color: white;
        }

        .prooph-logo {
            float: left;
            margin-left: 8px;
            margin-right: 8px;
            transition-timing-function: ease-in-out;
            transition: all 5s;
            height: 50px;
            padding: 5px;
        }

        .prooph-logo:hover {
            transition: all .7s;
            transition-timing-function: ease-out;
            transform: rotate(360deg);
        }

        /* Top Navigation */
        @media (max-width: 767px) {
            ul.navbar-nav {
                margin: 0 -15px
            }

            ul.navbar-nav li {
                border-radius: 0;
            }

            ul.navbar-nav li ul {
                background: rgba(255, 255, 255, 0.2);
                border: none;
                border-radius: 0;
                box-shadow: none;
                display: block;
                float: none;
                left: auto;
                padding: 0;
                position: static;
            }

            ul.navbar-nav li ul li a {
                padding: 8px 30px;
            }

            ul.navbar-nav li ul li ul li a {
                padding: 6px 40px;
            }
        }

        @media (min-width: 768px) {

            ul.navbar-nav li {
                display: block;
                position: relative;
                float: left;
            }

            ul.navbar-nav li ul {
                display: none;
            }

            ul.navbar-nav li a {
                display: block;
            }

            ul.navbar-nav li:hover > ul {
                display: block;
                position: absolute;
            }

            ul.navbar-nav li:hover li {
                float: none;
            }

            ul.navbar-nav ul ul {
                left: 100%;
                top: 0;
            }
        }
    </style>
    </head>
    <body data-spy="scroll" data-target="#sideNav" data-offset="50" class="bbt-theme-cerulean">
    <div class="page-wrapper">
        <header>
    <nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                    data-target="#js-navbar-collapse" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
                    </div>

        <div class="collapse navbar-collapse" id="js-navbar-collapse">
            
    
    <ul class="nav navbar-nav">
        <a href="/">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" class="prooph-logo">
                <defs>
                    <style>
                        .cls-1{fill:#04a1b0;}.cls-2{fill:#26896c;}.cls-3{fill:#eeca50;}.cls-4{fill:#eb6842;}.cls-5{fill:#cc3340;}.cls-6{fill:#715671;}
                    </style>
                </defs>
                <title>prooph-logo</title>
                <g id="artwork">
                    <g id="Layer_5" data-name="Layer 5">
                        <path class="cls-1"
                              d="M57.22,17,67.84,35.43a1.77,1.77,0,0,0,1.53.89h61.25a1.77,1.77,0,0,0,1.53-.89L142.78,17a1.77,1.77,0,0,0-1.53-2.66H58.76A1.77,1.77,0,0,0,57.22,17Z"/>
                        <path class="cls-2"
                              d="M29.54,94.68l30.63-53a1.77,1.77,0,0,0,0-1.77L49.55,21.48a1.77,1.77,0,0,0-3.07,0L5.24,92.91a1.77,1.77,0,0,0,1.53,2.66H28A1.77,1.77,0,0,0,29.54,94.68Z"/>
                        <path class="cls-3"
                              d="M60.16,158.36l-30.63-53a1.77,1.77,0,0,0-1.53-.89H6.78a1.77,1.77,0,0,0-1.53,2.66l41.24,71.43a1.77,1.77,0,0,0,3.07,0l10.61-18.38A1.77,1.77,0,0,0,60.16,158.36Z"/>
                        <path class="cls-4"
                              d="M130.63,163.68H69.37a1.77,1.77,0,0,0-1.53.89L57.22,183a1.77,1.77,0,0,0,1.53,2.66h82.48a1.77,1.77,0,0,0,1.53-2.66l-10.61-18.38A1.77,1.77,0,0,0,130.63,163.68Z"/>
                        <path class="cls-5"
                              d="M170.46,105.32l-30.63,53a1.77,1.77,0,0,0,0,1.77l10.61,18.38a1.77,1.77,0,0,0,3.07,0l41.24-71.43a1.77,1.77,0,0,0-1.53-2.66H172A1.77,1.77,0,0,0,170.46,105.32Z"/>
                        <path class="cls-6"
                              d="M139.84,41.64l30.63,53a1.77,1.77,0,0,0,1.53.89h21.23a1.77,1.77,0,0,0,1.53-2.66L153.52,21.48a1.77,1.77,0,0,0-3.07,0L139.84,39.86A1.77,1.77,0,0,0,139.84,41.64Z"/>
                    </g>
                </g>
            </svg>
        </a>
                        <li>
    <a href="/intro.html">Introduction</a>

    </li>
                        <li>
    <a href="/variants.html">Variants</a>

    </li>
                        <li>
    <a href="/interop_factories.html">Interop Factories</a>

    </li>
            </ul>

        </div>
    </div>
</nav>
</header>
<div class="container">
    <ol class="breadcrumb">
                        <li><a href="/">PDO Event Store</a></li>
                                <li class="active">Interop Factories</li>
            </ol>
    <div class="row">

                <div class="col-md-3">
            <nav class="nav-left hidden-xs hidden-sm" id="sideNav">
    <ul class="nav nav-stacked" data-spy="affix" data-offset-top="59" role="tablist">
                                <li>
                <a href="#3" title="Interop&#x20;Factories">Interop Factories</a>
            </li>
                                <li>
                <a href="#3-1" title="Factory-Driven&#x20;Creation">Factory-Driven Creation</a>
            </li>
                                                                                                            </ul>
</nav>
        </div>
                <div class="col-md-9">
<div id="section-main"><h1 id="3">Interop Factories</h1>
<p>Instead of providing a module, a bundle, a bridge or similar framework integration prooph/event-store ships with <code>interop factories</code>.</p>
<h2 id="3-1">Factory-Driven Creation</h2>
<p>The concept behind these factories (see <code>src/Container</code> folder) is simple but powerful. It allows us to provide you with bootstrapping logic for the event store and related components
without the need to rely on a specific framework. However, the factories have three requirements.</p>
<h3 id="3-1-1">Requirements</h3>
<ol>
<li>Your Inversion of Control container must implement the <a href="https://github.com/php-fig/container">PSR Container interface</a>.</li>
<li>
<a href="https://github.com/sandrokeil/interop-config">interop-config</a> must be installed</li>
<li>The application configuration should be registered with the service id <code>config</code> in the container.</li>
</ol>
<p><em>Note: Don't worry, if your environment doesn't provide these requirements, you can
always bootstrap the components by hand. Just look at the factories for inspiration in this case.</em></p>
<h3 id="3-1-2">MariaDbEventStoreFactory</h3>
<p>If the requirements are met you just need to add a new section in your application config ...</p>
<pre><code class="language-php">[
    'prooph' =&gt; [
        'event_store' =&gt; [
            'default' =&gt; [
                'wrap_action_event_emitter' =&gt; true,
                'metadata_enrichers' =&gt; [
                    // The factory will get the metadata enrichers and inject them in the MetadataEnricherPlugin.
                    // Note: you can obtain the same result by instanciating the plugin yourself
                    // and pass it to the 'plugin' section bellow.
                    'metadata_enricher_1',
                    'metadata_enricher_2',
                    // ...
                ],
                'plugins' =&gt; [
                    //And again the factory will use each service id to get the plugin from the container
                    //Plugin::attachToEventStore($eventStore) is then invoked by the factory so your plugins
                    // get attached automatically
                    //Awesome, isn't it?
                    'plugin_1_service_id',
                    'plugin_2_service_id',
                    //...
                ],
                'connection' =&gt; 'my_pdo_connection', // service id for the used pdo connection
                'persistence_strategy' =&gt; MariaDbSingleStreamStrategy::class, // service id for the used persistance strategy
                'load_batch_size' =&gt; 1000, // how many events a query should return in one batch, defaults to 1000
                'event_streams_table' =&gt; 'event_streams', // event stream table to use, defaults to `event_streams`
                'message_factory' =&gt; FQCNMessageFactory::class, // message factory to use, defauls to `FQCNMessageFactory::class`
            ],
        ],
    ],
    'dependencies' =&gt; [
        'factories' =&gt; [
            'MariaDbEventStore' =&gt; [
                \Prooph\EventStore\Container\MariaDbEventStoreFactory::class,
                'default',
            ],
        ],
    ],
    //... other application config here
]
</code></pre>
<p>$eventStore = $container-&gt;get('MariaDbEventStore');</p>
<h3 id="3-1-3">MariaDbProjectionManagerFactory</h3>
<pre><code class="language-php">[
    'prooph' =&gt; [
        'projection_manager' =&gt; [
            'default' =&gt; [
                'event_store' =&gt; 'MariaDbEventStore',
                'connection' =&gt; 'my_pdo_connection', // service id for the used pdo connection
                'event_streams_table' =&gt; 'event_streams', // event stream table to use, defaults to `event_streams` 
                'projections_table' =&gt; 'projections', // projection table to use, defaults to `projections`
            ],
        ],
    ],
    'dependencies' =&gt; [
        'factories' =&gt; [
            'MariaDbProjectionManager' =&gt; [
                \Prooph\EventStore\Container\MariaDbProjectionManagerFactory::class,
                'default',
            ],
        ],
    ],
    //... other application config here
]
</code></pre>
<p>$projectionManager = $container-&gt;get('MariaDbProjectionManager');</p>
<h3 id="3-1-4">MySqlEventStoreFactory</h3>
<p>If the requirements are met you just need to add a new section in your application config ...</p>
<pre><code class="language-php">[
    'prooph' =&gt; [
        'event_store' =&gt; [
            'default' =&gt; [
                'wrap_action_event_emitter' =&gt; true,
                'metadata_enrichers' =&gt; [
                    // The factory will get the metadata enrichers and inject them in the MetadataEnricherPlugin.
                    // Note: you can obtain the same result by instanciating the plugin yourself
                    // and pass it to the 'plugin' section bellow.
                    'metadata_enricher_1',
                    'metadata_enricher_2',
                    // ...
                ],
                'plugins' =&gt; [
                    //And again the factory will use each service id to get the plugin from the container
                    //Plugin::attachToEventStore($eventStore) is then invoked by the factory so your plugins
                    // get attached automatically
                    //Awesome, isn't it?
                    'plugin_1_service_id',
                    'plugin_2_service_id',
                    //...
                ],
                'connection' =&gt; 'my_pdo_connection', // service id for the used pdo connection
                'persistence_strategy' =&gt; MySqlSingleStreamStrategy::class, // service id for the used persistance strategy
                'load_batch_size' =&gt; 1000, // how many events a query should return in one batch, defaults to 1000
                'event_streams_table' =&gt; 'event_streams', // event stream table to use, defaults to `event_streams`
                'message_factory' =&gt; FQCNMessageFactory::class, // message factory to use, defauls to `FQCNMessageFactory::class`
            ],
        ],
    ],
    'dependencies' =&gt; [
        'factories' =&gt; [
            'MySqlEventStore' =&gt; [
                \Prooph\EventStore\Container\MySqlEventStoreFactory::class,
                'default',
            ],
        ],
    ],
    //... other application config here
]
</code></pre>
<p>$eventStore = $container-&gt;get('MySqlEventStore');</p>
<h3 id="3-1-5">MySqlProjectionManagerFactory</h3>
<pre><code class="language-php">[
    'prooph' =&gt; [
        'projection_manager' =&gt; [
            'default' =&gt; [
                'event_store' =&gt; 'MySqlEventStore',
                'connection' =&gt; 'my_pdo_connection', // service id for the used pdo connection
                'event_streams_table' =&gt; 'event_streams', // event stream table to use, defaults to `event_streams` 
                'projections_table' =&gt; 'projections', // projection table to use, defaults to `projections`
            ],
        ],
    ],
    'dependencies' =&gt; [
        'factories' =&gt; [
            'MySqlProjectionManager' =&gt; [
                \Prooph\EventStore\Container\MySqlProjectionManagerFactory::class,
                'default',
            ],
        ],
    ],
    //... other application config here
]
</code></pre>
<p>$projectionManager = $container-&gt;get('MySqlProjectionManager');</p>
<h3 id="3-1-6">PostgresEventStoreFactory</h3>
<p>If the requirements are met you just need to add a new section in your application config ...</p>
<pre><code class="language-php">[
    'prooph' =&gt; [
        'event_store' =&gt; [
            'default' =&gt; [
                'wrap_action_event_emitter' =&gt; true,
                'metadata_enrichers' =&gt; [
                    // The factory will get the metadata enrichers and inject them in the MetadataEnricherPlugin.
                    // Note: you can obtain the same result by instanciating the plugin yourself
                    // and pass it to the 'plugin' section bellow.
                    'metadata_enricher_1',
                    'metadata_enricher_2',
                    // ...
                ],
                'plugins' =&gt; [
                    //And again the factory will use each service id to get the plugin from the container
                    //Plugin::attachToEventStore($eventStore) is then invoked by the factory so your plugins
                    // get attached automatically
                    //Awesome, isn't it?
                    'plugin_1_service_id',
                    'plugin_2_service_id',
                    //...
                ],
                'connection' =&gt; 'my_pdo_connection', // service id for the used pdo connection
                'persistence_strategy' =&gt; PostgresSingleStreamStrategy::class, // service id for the used persistance strategy
                'load_batch_size' =&gt; 1000, // how many events a query should return in one batch, defaults to 1000
                'event_streams_table' =&gt; 'event_streams', // event stream table to use, defaults to `event_streams`
                'message_factory' =&gt; FQCNMessageFactory::class, // message factory to use, defauls to `FQCNMessageFactory::class`
            ],
        ],
    ],
    'dependencies' =&gt; [
        'factories' =&gt; [
            'PostgresEventStore' =&gt; [
                \Prooph\EventStore\Container\PostgresEventStoreFactory::class,
                'default',
            ],
        ],
    ],
    //... other application config here
]
</code></pre>
<p>$eventStore = $container-&gt;get('PostgresEventStore');</p>
<h3 id="3-1-7">PostgresProjectionManagerFactory</h3>
<pre><code class="language-php">[
    'prooph' =&gt; [
        'projection_manager' =&gt; [
            'default' =&gt; [
                'event_store' =&gt; 'PostgresEventStore',
                'connection' =&gt; 'my_pdo_connection', // service id for the used pdo connection
                'event_streams_table' =&gt; 'event_streams', // event stream table to use, defaults to `event_streams` 
                'projections_table' =&gt; 'projections', // projection table to use, defaults to `projections`
            ],
        ],
    ],
    'dependencies' =&gt; [
        'factories' =&gt; [
            'PostgresProjectionManager' =&gt; [
                \Prooph\EventStore\Container\PostgresProjectionManagerFactory::class,
                'default',
            ],
        ],
    ],
    //... other application config here
]
</code></pre>
<p>$projectionManager = $container-&gt;get('PostgresProjectionManager');</p>
<h3 id="3-1-8">PdoConnectionFactory</h3>
<pre><code class="language-php">[
    'prooph' =&gt; [
        'pdo_connection' =&gt; [
            'default' =&gt; [
                'schema', // one of mysql or pgsql
                'user', // username to use
                'password', // password to use
                'port', // port to use
                'host' =&gt; '127.0.0.1', // host name, defaults to `127.0.0.1`
                'dbname' =&gt; 'event_store', // database name, defaults to `event_store`
                'charset' =&gt; 'utf8', // chartset, defaults to `UTF-8`,
            ],
        ],
    ],
    'dependencies' =&gt; [
        'factories' =&gt; [
            'my_pdo_connection' =&gt; [
                \Prooph\EventStore\Container\PdoConnectionFactory::class,
                'default',
            ],
        ],
    ],
    //... other application config here
]
</code></pre>
<p>$pdoConnection = $container-&gt;get('my_pdo_connection');</p>
</div>        </div>
    </div>
</div>

<footer>
    <div class="links">
        <div class="container">
            <div class="row">
                <div class="prev col-xs-6">
                                            <a href="/variants.html">Previous</a>                                    </div>
                <div class="next col-xs-6">
                                    </div>
            </div>
        </div>
    </div>
    <div id="copyright">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <p>Powered by <a href="https://github.com/prooph/bookdown-template" title="Visit project to generate your own docs">Bookdown Bootswatch Templates</a>.</p>
                </div>
            </div>
        </div>
    </div>
</footer>
    </div>
    <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
            integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
            crossorigin="anonymous"></script>
    <script src="https://prooph.github.io/share/prismjs/main.js"></script>
    <script src="https://prooph.github.io/share/prismjs/prism.js"></script>
</body>
</html>
